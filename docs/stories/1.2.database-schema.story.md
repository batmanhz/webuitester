# Story 1.2: Database Schema & Basic CRUD API
**Status**: Draft

## Story
**As a** Developer,
**I want** to set up the SQLite database with Tortoise ORM and create the basic data models,
**so that** we can persist Test Cases and Test Runs.

## Acceptance Criteria
1.  Tortoise ORM configured with SQLite (`webuitester.db`).
2.  Data Models created for `TestCase`, `TestStep`, and `TestRun` matching the Architecture.
3.  Pydantic schemas (Pydantic models) created for API request/response.
4.  Database initialization script (or startup event) handles table creation.
5.  Basic CRUD API endpoints for `TestCase` (List, Create, Get) are implemented and tested.

## Tasks / Subtasks
- [ ] Install Dependencies
    - [ ] Add `tortoise-orm`, `aerich` (migrations) to `requirements.txt`.

- [ ] Database Configuration
    - [ ] Create `backend/app/core/database.py` (Tortoise config).
    - [ ] Configure `register_tortoise` in `backend/main.py`.

- [ ] Define Models [Source: architecture.md#5.1]
    - [ ] Create `backend/app/models/test_case.py` (TestCase, TestStep).
        - `TestCase`: id (UUID), name, url, created_at.
        - `TestStep`: id, case_id (FK), order, instruction, expected_result.
    - [ ] Create `backend/app/models/test_run.py` (TestRun).
        - `TestRun`: id, case_id (FK), status, logs (JSON), result_summary.

- [ ] Define Schemas (Pydantic)
    - [ ] Create `backend/app/schemas/test_case.py`.
    - [ ] Create `backend/app/schemas/test_run.py`.

- [ ] Implement CRUD Endpoints [Source: architecture.md#6.1]
    - [ ] Create `backend/app/api/endpoints/test_cases.py`.
        - `GET /api/cases`
        - `POST /api/cases`
        - `GET /api/cases/{id}`
    - [ ] Register router in `backend/main.py`.

## Dev Notes
### Architecture Alignment
*   **ORM**: Tortoise ORM (Async) as specified in `architecture.md` Section 7.
*   **Database**: SQLite (`webuitester.db`) local file.

### Data Model Details
*   `TestCase` has a One-to-Many relationship with `TestStep`.
*   `TestRun` has a Many-to-One relationship with `TestCase`.
*   `logs` in `TestRun` should be a JSONField to store structured logs.

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-12-27 | 1.0 | Initial Draft | Bob (SM) |
